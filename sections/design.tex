\documentclass[../main.tex]{subfiles}

\begin{document}
	By utilizing the aforementioned remote-attestation process, we can provision the trusted component 
	of the remote server application with an SSL private key while making it extremely difficult* for even
	\textit{privileged} processes running on the cloud provider to access the key. This is a stark contrast to current
	schemes wherein the private key is merely shipped as part of the server application to the cloud provider. 

	In SSL/TLS, the private key is required by some operations during the handshake step to derive an ephemeral symmetric session key. These operations
	are executed within the trusted component, and are invoked by the non-trusted component via an interface that we define in this section. Note that
	the interface has to be carefully designed to allow the handshake to complete correctly while not exposing the long term private key through an oracle.
	However, before discussing the design we have implemented, we first provide a brief overview of the SSL/TLS handshake, highlighting
	the steps where the private key is used.

	\subsection{SSL/TLS handshake}
	%add a figure with the handshake and walk-through it
	To generate the master key, from which further (session) keys
	are derived, the RSA handshake requires three random components:
	\begin{itemize}
		\item Client random - generated by the client and sent over the network in the clear
		\item Premaster secret - generated by the client and sent, encrypted with the server's public key, over the network
		\item Server random - generated by the server and sent in the clear
	\end{itemize}

	%this needs expansion
	The secrecy of the master key is guaranteed by the fact that only the server is in possesion of the private key to decrypt the premaster secret.

	We need to secure against the malicious OS supplying the server random component, which would force the trusted component to generate the same session keys which would lead to private key oracle. [Wedge citation]


	We consider two scenarios:
	\begin{itemize}
		\item Session keys available to the OS
		\item Session keys hidden inside the enclave and accessible through encrypt/decrypt oracle
	\end{itemize}


	\begin{figure}[H]
		\centering
		\begin{Lsc}{none}{5}{10}
			\begin{lscinst}[noboxSD]{Client}
				\lscLine{hot}{0.5}
				\lscAsynSnd{clnthello}
				\lscLine{hot}{3}
				\lscAsynRcv{srvrhello}
				\lscLine{hot}{0.4}
				\lscAsynRcv{srvrcert}
				\lscAsynSnd{clntkeyx}
				\lscLine{hot}{0.4}
				\lscAsynSnd{clntchngcipher}
				\lscLine{hot}{0.4}
				\lscAsynSnd{clntfinish}
				\lscLine{hot}{2.5}
				\lscAsynRcv{srvrchngcipher}
				\lscLine{hot}{0.4}
				\lscAsynRcv{srvrfinish}
				\lscLine{hot}{2.4}
			\end{lscinst}
			\begin{lscinst}[noboxSD]{}
			\end{lscinst}
			\begin{lscinst}[noboxSD]{Server}
				\lscLine{hot}{1}
				\lscAsynRcv{clnthello}
				\lscAsynSnd{clntrandom}
				\lscLine{hot}{0.4}
				\lscAsynSnd{getsrvrandom}
				\lscLine{hot}{1.6}
				\lscAsynRcv{srvrandom}
				\lscAsynSnd{srvrhello}
				\lscLine{hot}{0.4}
				\lscAsynSnd{srvrcert}
				\lscLine{hot}{1}
				\lscAsynRcv{clntkeyx}
				\lscLine{hot}{0.4}
				\lscAsynRcv{clntchngcipher}
				\lscLine{hot}{0.4}
				\lscAsynRcv{clntfinish}
				\lscAsynSnd{getsesskey}
				\lscLine{hot}{1.5}
				\lscAsynRcv{sesskey}
				\lscAsynSnd{srvrchngcipher}
				\lscLine{hot}{0.4}
				\lscAsynSnd{srvrfinish}
				\lscLine{hot}{2.9}
			\end{lscinst}
			\begin{lscinst}[noboxSD]{}
			\end{lscinst}
			\begin{lscinst}[noboxSD]{Enclave}
				\lscLine{hot}{1.5}
				\lscAsynRcv{clntrandom}
				\lscLine{hot}{0.4}
				\lscAsynRcv{getsrvrandom}
				\lscLine{hot}{0.6}
				\lscAsynSnd{srvrandom}
				\lscLine{hot}{3.2}
				\lscAsynRcv{getsesskey}
				\lscLine{hot}{0.5}
				\lscAsynSnd{sesskey}
				\lscLine{hot}{3.8}
			\end{lscinst}
			\lscAsyn{clnthello}{hot}{\texttt{Client Hello\{client\_random\}}}
			\lscAsyn{clntrandom}{hot}{\texttt{ClientRandom}}
			\lscAsyn{getsrvrandom}{hot}{\texttt{GetServerRandom}}
			\lscAsyn{srvrandom}{hot}{\texttt{ServerRandom}}
			\lscAsyn{srvrhello}{hot}{\texttt{ServerHello\{server\_random\}}}
			\lscAsyn{clntkeyx}{hot}{\texttt{ClientKeyExchange\{premaster\_secret\}}}
			\lscAsyn{clntchngcipher}{hot}{\texttt{ClientChangeCipherSpec}}
			\lscAsyn{clntfinish}{hot}{\texttt{MAC<master\_secret, all messages>}}
			\lscAsyn{getsesskey}{hot}{\texttt{GetSessionKeys\{premaster\_secret\}}}
			\lscAsyn{sesskey}{hot}{\texttt{SessionKeyBlock}}
			\lscAsyn{srvrfinish}{hot}{\texttt{MAC<master\_secret, all messages>}}
			\lscAsyn{srvrchngcipher}{hot}{\texttt{ServerChangeCipherSpec}}
		\end{Lsc}
		\caption{SSL handshake}
		\label{fig:rsashake}
	\end{figure}



	\paragraph{ECDHE Handshake}
	TBC..

\end{document}